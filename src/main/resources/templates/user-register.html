<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/head :: commonHead"></head>
<body class="index-page">

<main class="main">
    <section class="container d-flex justify-content-center align-items-center py-5" style="min-height: 80vh;">
        <div style="width: 100%; max-width: 420px;">
            <div class="text-center mb-4">
                <h2>ğŸ«ŸOppsMoney</h2>
                <p class="text-muted">Oopsì— ê°€ì…í•˜ê³  êµ¬ë…ì„ ë˜‘ë˜‘í•˜ê²Œ ê´€ë¦¬í•˜ì„¸ìš”.</p>
            </div>

            <form th:action="@{/users/register}" method="post" onsubmit="return validateForm()">
                <div class="mb-3">
                    <input type="text" class="form-control text-muted" id="name" name="name" placeholder="ì´ë¦„" required>
                </div>

                <div class="mb-3">
                    <div class="input-group">
                        <input type="email" class="form-control text-muted" id="email" name="email" placeholder="ì´ë©”ì¼" required>
                        <button type="button" class="btn btn-outline-secondary" onclick="checkEmail()">í™•ì¸</button>
                    </div>
                </div>

                <div class="mb-3">
                    <div class="input-group">
                        <input type="text" class="form-control text-muted" id="nickname" name="nickname" placeholder="ë‹‰ë„¤ì„" required>
                        <button type="button" class="btn btn-outline-secondary" onclick="checkNickname()">í™•ì¸</button>
                    </div>
                </div>

                <div class="mb-3">
                    <input type="password" class="form-control text-muted" id="password" name="password" placeholder="ë¹„ë°€ë²ˆí˜¸" required onfocus="showPwTip()">
                </div>

                <div class="mb-3">
                    <input type="password" class="form-control text-muted" id="confirmPassword" name="confirmPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ í™•ì¸" required>
                </div>

                <div class="info text-muted text-center" id="pw-tip" style="display: none; font-size: 13px;">
                    âš ï¸ 8ì ì´ìƒ, ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨
                </div>

                <!-- âœ… ì•½ê´€ ë™ì˜ ì²´í¬ -->
                <div class="form-check text-center mt-3 mb-3">
                    <input class="form-check-input" type="checkbox" id="termsCheck">
                    <label class="form-check-label" for="termsCheck" style="font-size: 12px; color: #999;">
                        íšŒì›ê°€ì…ê³¼ ë™ì‹œì— ê°œì¸ì •ë³´ ì·¨ê¸‰ë°©ì¹¨ ë° ì´ìš©ì•½ê´€ì— ë™ì˜í•˜ê²Œ ë©ë‹ˆë‹¤.
                    </label>
                </div>

                <div class="d-grid mt-3">
                    <button type="submit" class="btn btn-block" style="background-color: #17b5b5; color: white;">ê°€ì…í•˜ê¸°</button>
                </div>

                <p></p>

                <div class="text-center">
                    <a th:href="@{/users/login}" style="color: #17b5b5;">ì´ë¯¸ íšŒì›ì´ì‹ ê°€ìš”? <span style="color: #17b5b5; font-weight: 500;">ë¡œê·¸ì¸</span></a>
                </div>

                <div th:if="${error}" class="alert alert-danger mt-3" th:text="${error}"></div>
            </form>
        </div>
    </section>
</main>

<script>
    function checkNickname() {
        const nickname = document.getElementById('nickname').value;
        fetch(`/users/check-nickname?nickname=${nickname}`)
            .then(res => res.json())
            .then(data => {
                alert(data.available ? "ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤." : "ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤.");
            });
    }

    function checkEmail() {
        const email = document.getElementById('email').value;
        fetch(`/users/check-email?email=${email}`)
            .then(res => res.json())
            .then(data => {
                alert(data.available ? "ì‚¬ìš© ê°€ëŠ¥í•œ ì´ë©”ì¼ì…ë‹ˆë‹¤." : "ì´ë¯¸ ê°€ì…ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.");
            });
    }

    function showPwTip() {
        document.getElementById("pw-tip").style.display = 'block';
    }

    function validateForm() {
        const pw = document.getElementById("password").value;
        const cpw = document.getElementById("confirmPassword").value;
        const pwRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;
        const termsChecked = document.getElementById("termsCheck").checked;

        if (pw !== cpw) {
            alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
            return false;
        }
        if (!pwRegex.test(pw)) {
            alert("ë¹„ë°€ë²ˆí˜¸ëŠ” 8ì ì´ìƒì´ë©°, ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.");
            return false;
        }
        if (!termsChecked) {
            alert("ì•½ê´€ì— ë™ì˜í•˜ì…”ì•¼ íšŒì›ê°€ì…ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
            return false;
        }
        return true;
    }
</script>

<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
    <i class="bi bi-arrow-up-short"></i>
</a>
<div id="preloader"></div>
<div th:replace="fragments/footer :: commonFooter"></div>
</body>
</html>
